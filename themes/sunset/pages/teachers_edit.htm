title = "Edit Teacher"
url = "/teachers/:id/edit"
layout = "default"
is_hidden = 0
==
<?php
use Illuminate\Support\Facades\Schema;
use Illuminate\Support\Facades\Validator;
use Winter\Storm\Exception\ValidationException;

function onStart()
{
    $this['teachersReady'] = Schema::hasTable('latihan_teachers');
    if (!$this['teachersReady']) {
        $this['teacher'] = null;
        return;
    }

    $id = (int) $this->param('id');
    $teacher = Db::table('latihan_teachers')->where('id', $id)->first();
    if (!$teacher) {
        Session::flash('error', 'Teacher tidak ditemukan.');
        return Redirect::to($this->pageUrl('teachers'));
    }

    $this['teacher'] = $teacher;
}

function onSave()
{
    if (!Schema::hasTable('latihan_teachers')) {
        Session::flash('error', 'Tabel latihan_teachers belum tersedia.');
        return Redirect::to($this->pageUrl('teachers'));
    }

    $id = (int) $this->param('id');
    $teacher = Db::table('latihan_teachers')->where('id', $id)->first();
    if (!$teacher) {
        Session::flash('error', 'Teacher tidak ditemukan.');
        return Redirect::to($this->pageUrl('teachers'));
    }

    $data = [
        'name' => trim((string) post('name')),
        'subject' => trim((string) post('subject')),
        'is_active' => post('is_active') ? 1 : 0,
    ];

    $validator = Validator::make($data, [
        'name' => 'required|string|max:255',
        'subject' => 'required|string|max:255',
        'is_active' => 'boolean',
    ]);

    if ($validator->fails()) {
        throw new ValidationException($validator);
    }

    Db::table('latihan_teachers')->where('id', $id)->update([
        'name' => $data['name'],
        'subject' => $data['subject'],
        'is_active' => $data['is_active'],
        'updated_at' => date('Y-m-d H:i:s'),
    ]);

    Session::flash('success', 'Teacher berhasil disimpan.');
    return Redirect::to($this->pageUrl('teachers_edit', ['id' => $id]));
}
?>
==
<div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
  <div>
    <h3 class="fw-bold mb-1">Edit Teacher</h3>
    <p class="text-muted mb-0">Perbarui data teacher.</p>
  </div>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary" href="{{ 'teachers'|page }}">
      <i class="bi bi-arrow-left me-1"></i> Back
    </a>
  </div>
</div>

{% if not teachersReady %}
  <div class="alert alert-warning">
    Tabel <code>latihan_teachers</code> belum ada. Jalankan migration plugin <code>Latihan.Latihan</code> dulu.
  </div>
{% else %}
  {% partial "teachers/form" mode="edit" %}
{% endif %}
